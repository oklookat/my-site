FROM debian:bullseye


# set the locale
RUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y locales
RUN sed -i -e 's/# ru_RU.UTF-8 UTF-8/ru_RU.UTF-8 UTF-8/' /etc/locale.gen && \
    dpkg-reconfigure --frontend=noninteractive locales && \
    update-locale LANG=ru_RU.UTF-8
ENV LANG ru_RU.UTF-8 

# install postgres
RUN apt update
RUN apt install -y curl apt-transport-https gnupg2
RUN curl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc | gpg --dearmor -o /usr/share/keyrings/postgresql-keyring.gpg
RUN echo "deb [signed-by=/usr/share/keyrings/postgresql-keyring.gpg] http://apt.postgresql.org/pub/repos/apt/ bullseye-pgdg main" | tee /etc/apt/sources.list.d/postgresql.list
RUN apt update
RUN apt install -y postgresql-14

# set pg env
ENV POSTGRES_PASSWORD=root
ENV POSTGRES_DB=elven
ENV PGDATA=/var/lib/postgresql/data/pgdata

# rights
RUN chmod -R 777 /var/lib/postgresql
RUN chown -R postgres:postgres /var/lib/postgresql

# run
USER postgres
RUN initdb --locale=ru_RU.UTF-8 -D ${PGDATA}
CMD ["pg_ctl", "start", "-D", "$PGDATA"]
#EXPOSE 5432
